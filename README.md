# 刷新测试器（扩展版）v0.1.1

## 与原刷新测试器的区别？

修改测试编写逻辑，无需手动写AvZ代码，而是直接用封装好的 `Cob`, `FixedCard` 与 `SmartCard`.

这样做的好处是：
- 可以自动生成文件名，对大批量测试非常友好
- 可以自动推测需要选的卡

这样做的局限是：
- 暂时无法测定控制变量的情况

## 文件命名规则

输出文件采用[法棍](https://assassinscreed.fandom.com/wiki/Arno_Dorian)式命名，以 `I(100) PP(301, {1,5}-9), J(600, 3, 9), A(900, 红白[1,2→2, 5,6→5]-9) y(红白) n(车) g(0) RHUD.xlsx` 为例：
```c++
// 操作部分
I(100)                         // 于100生效冰
PP(301, {1,5}-9)               // 于301生效炸(1,9)与炸(5,9)的炮
J(600, 3, 9)                   // 于600生效(3,9)的辣椒
A(900, 红白[1,2→2, 5,6→5]-9)    // 于900生效樱桃，智能判断红眼+白眼数，若1,2路多放2路，若5,6路多放6路，列数固定为9

// 设置部分
y(红白)        // 出怪包含红眼、白眼
n(车)          // 出怪不包含冰车
g(0)          // 红眼数量限制为0（无限制则不标注）
R/S           // 测试激活(R) / 测试分离(S)
H             // 测试大波（若测试普通波则不标注）
U             // 使用极限出怪（若使用自然出怪则不标注）
D             // 开启Dance Cheat（若不开启则不标注）
```

> `J` 表示辣椒，因其节省文件名长度且更清晰

> `W` 表示窝瓜，因为 NTFS 不区分大小写

> `I`, `A`, `J`, `W` 以外的卡片表示为 `Cxx`, 其中 `xx` 为该卡片的自然序号（豌豆射手为 0, 依次类推）

## 如何使用

本框架只支持AvZ1（[安装包下载](https://www.bilibili.com/read/cv20065614/)）。

### 安装可多开、已解锁隐藏页面的英文原版PvZ

可从 [pt 站](https://pvz.tools/download/)下载。

> 注：请勿使用囧姨站的文件。


### 安装插件

将 `avz\inc` 目录下的文件复制至 `你的AvZ安装目录\inc` 下。


### 配置脚本目录

笔者建议单独建一个用于存放测试脚本的目录。

假设此目录名为 `refresh_tests`, 请构建如下结构：
```
...\refresh_tests
└─bin
   └─injector.exe
├─compile.py
├─run.py
└─各种脚本.cpp
```

以上结构与本仓库是对应的。

### 试运行

本仓库 `saves` 文件夹里提供了供测试用的存档文件。

根据实际情况，编辑以下文件的配置部分：
- `PE-activate.cpp`
- `compile.py`
- `run.py`

然后依次执行：
```console
.\compile.py -test
.\run.py
```

检查输出文件是否完好存在。

### 开测！

供参考的正式测试配置：
- `TOTAL_COUNT = 1000`
- `batch_count = 100`（根据试运行所花时长调整）
- `num_of_batch_to_run = 10`（对应 PvZ 10开，若配置较低可改为 5）

依次执行：
```console
.\compile.py
.\run.py
```

每批运行完毕后，重复执行`.\run.py`即可。


## FAQ
> 为什么不和原有的refresh插件合并？

扩展版与原插件不兼容，暂时没有合并的打算。

> `PE-active.cpp` 是什么？

它涵盖了[自然出怪论 Part2](https://docs.qq.com/doc/DTlpGdUpmYkpxZEVZ) 中 `PE\...\激活` 的所有测试<del>（还附赠了原数据里缺失的2条数据）</del>。

更多测试脚本待补。欢迎向本仓库贡献并提交 pull request.
